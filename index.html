<meta charset="utf-8">
<!--
このファイルのライセンスは Boost Software License, Version 1.0. ( http://www.boost.org/LICENSE_1_0.txt ) とします。
-->
<script type="text/x-mathjax-config">
MathJax.Hub.Config
(
    {
        tex2jax:
        {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            skipTags: ["script","noscript","style","textarea","code"]
        }
    }
);
</script>
<script>
'use strict';
(function()
{
    var globalState = { };

    RegExp.escape = function(s)
    {
        //  https://stackoverflow.com/questions/3561493/is-there-a-regexp-escape-function-in-javascript
        return s.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
    };
    var objectAssign = function(target, source)
    {
        //  copy from https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Object/assign#Polyfill
        if (typeof Object.assign !== 'function') {
            (function () {
                Object.assign = function (target) {
                'use strict';
                if (target === undefined || target === null) {
                    throw new TypeError('Cannot convert undefined or null to object');
                }
                var output = Object(target);
                for (var index = 1; index < arguments.length; index++) {
                    var source = arguments[index];
                    if (source !== undefined && source !== null) {
                        for (var nextKey in source) {
                            if (Object.prototype.hasOwnProperty.call(source, nextKey)) {
                                output[nextKey] = source[nextKey];
                            }
                        }
                    }
                }
                return output;
                };
            })();
        }

        Object.assign(target, source);
        return target;
    }
    var showError = function(innerHTML)
    {
        document.body.style = "margin: 0px;";
        var errorDiv = document.createElement("div");
        errorDiv.style = "color: #AA3322; background-color: #442211; font-size: 1.5rem; padding: 0.4rem; text-align: center;";
        errorDiv.innerHTML = innerHTML;
        document.body.appendChild(errorDiv);
    }
    var appendLink = function(args)
    {
        var link = document.createElement("link");
        link.rel = args.rel;
        link.type = args.type;
        link.href = args.href;
        if (undefined !== args.id)
        {
            link.id = args.id;
        }
        document.head.appendChild(link);
    }
    var appendTheme = function(href, id)
    {
        appendLink
        (
            {
                rel: "stylesheet",
                type: "text/css",
                href: href,
                id: id
            }
        );
    }
    var makeAbsoluteUrl = function(base, url)
    {
        var baseParts = base.split("?")[0].split("/");
        if (4 <= baseParts.length && "" !== baseParts[baseParts.length -1])
        {
            // ファイル名部分の除去
            baseParts = baseParts.slice(0, -1);
        }
        if (4 <= baseParts.length && "" === baseParts[baseParts.length -1])
        {
            // 末尾の空要素を除去(しておかないと結合時に余分に / が挟まる)
            baseParts = baseParts.slice(0, -1);
        }
        var urlParts = url.split("/");
        if (0 <= urlParts[0].indexOf(":"))
        {
            //  絶対パスなので base 側は全て破棄
            baseParts = [];
        }
        else
        {
            if ("" === urlParts[0])
            {
                urlParts = urlParts.slice(1);
                if ("" === urlParts[1])
                {
                    //  プロトコルだけ利用
                    baseParts = baseParts.slice(0, 1);
                }
                else
                {
                    //  サーバー名まで利用
                    baseParts = baseParts.slice(0, 3);
                }
            }
            else
            {
                while(true)
                {
                    if ("." === urlParts[0])
                    {
                        urlParts = urlParts.slice(1);
                        continue;
                    }
                    if (".." === urlParts[0])
                    {
                        urlParts = urlParts.slice(1);
                        if (4 <= baseParts.length)
                        {
                            baseParts = baseParts.slice(0, -1);
                        }
                        continue;
                    }
                    break;
                }
            }
        }
        return baseParts.concat(urlParts).join("/");
    };
    var makeRelativeUrl = function(url)
    {
        var base = location.href.split("#")[0].split("?")[0];
        var baseParts = base.split("?")[0].split("/");
        if (4 <= baseParts.length && "" !== baseParts[baseParts.length -1])
        {
            // ファイル名部分の除去
            baseParts = baseParts.slice(0, -1);
        }
        if (4 <= baseParts.length && "" === baseParts[baseParts.length -1])
        {
            // 末尾の空要素を除去(しておかないと結合時に余分に / が挟まる)
            baseParts = baseParts.slice(0, -1);
        }
        var urlParts = url.split("/");
        var matchLength = 0;
        while(0 < baseParts.length && 0 < urlParts.length && baseParts[matchLength] === urlParts[matchLength])
        {
            ++matchLength;
        }
        switch(matchLength)
        {
        case 0:
            break;
        case 1: // 1 になることは通常あり得なくて 1 になることがあるとしたら恐らくどこかのバグ
        case 2:
            urlParts = [""].concat(urlParts.slice(1));
            break;
        default:
            urlParts = urlParts.slice(matchLength);
            break;
        }
        return urlParts.join("/");
    };
    var makeRebaseUrl = function(base, url)
    {
        return makeRelativeUrl(makeAbsoluteUrl(base, url));
    };
    var skipEscape = function(lines, map)
    {
        var currentEscape = null;
        return lines.map
        (
            function(line)
            {
                var escape = line.trim().slice(0, 3);
                var isEscape = null === currentEscape && ("```" === escape || "~~~" === escape) || currentEscape === escape;
                if (isEscape)
                {
                    if (null === currentEscape)
                    {
                        currentEscape = escape;
                    }
                    else
                    {
                        currentEscape = null;
                    }
                }
                else
                if (null === currentEscape)
                {
                    line = map(line);
                }
                return line;
            }
        );
    };
    var makeIndexForMarked = function(source)
    {
        var anchors = [ ];
        skipEscape
        (
            source.split("\n"),
            function(line)
            {
                var trimed_line = line;
                if (/^#+ [^ ]+/.test(trimed_line))
                {
                    var title = trimed_line
                        .replace(/^#* /, "")
                        .replace(/!\[.*?\]\(.*?\)/g, "")
                        .replace(/\[(.*?)\]\(.*?\)/g, "$1")
                        .replace(/(^|[^\\])<[^\>]*?[^\\]>/g, "$1") // エスケープを避けつつ適切に処理する為にはこの置換は2回行う必要がある。(3回は必要ない2回で十分)
                        .replace(/(^|[^\\])<[^\>]*?[^\\]>/g, "$1")
                        .replace(/\\\!/g,"!")
                        .replace(/\\\"/g,"\"")
                        .replace(/\\\#/g,"#")
                        .replace(/\\\$/g,"$")
                        .replace(/\\\%/g,"%")
                        .replace(/\\\&/g,"&")
                        .replace(/\\\'/g,"'")
                        .replace(/\\\(/g,"(")
                        .replace(/\\\)/g,")")
                        .replace(/\\\*/g,"*")
                        .replace(/\\\+/g,"+")
                        .replace(/\\\,/g,",")
                        .replace(/\\\./g,".")
                        .replace(/\\\//g,"/")
                        .replace(/\\\:/g,":")
                        .replace(/\\\;/g,";")
                        .replace(/\\\</g,"<")
                        .replace(/\\\=/g,"=")
                        .replace(/\\\>/g,">")
                        .replace(/\\\?/g,"?")
                        .replace(/\\\@/g,"@")
                        .replace(/\\\[/g,"[")
                        .replace(/\\\\/g,"\\")
                        .replace(/\\\]/g,"]")
                        .replace(/\\\^/g,"^")
                        .replace(/\\\_/g,"_")
                        .replace(/\\\`/g,"`")
                        .replace(/\\\{/g,"{")
                        .replace(/\\\|/g,"|")
                        .replace(/\\\}/g,"}")
                        .replace(/\\\~/g,"~")
                        .trim();
                    var level = (trimed_line.trim().length -trimed_line.replace(/^#*/, "").trim().length) -1;
                    var link = "#" +trimed_line.replace(/^#*/, "").replace(/!\[(.*?)\]\(.*?\)/g, "$1").replace(/\[(.*?)\]\(.*?\)/g, "$1").trim().toLowerCase().replace(/[\!\"\#\$\%\&\'\(\)\*\+\,\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~]/g,"").replace(/ /g,"-");
                    anchors.push
                    (
                        {
                            level: level,
                            title: title,
                            link: link
                        }
                    );
                }
            }
        );
        return anchors;
    };
    var translateRelativeLink = function(baseUrl, source)
    {
        return skipEscape
        (
            source.split("\n"),
            function(line)
            {
                var isInInlineEscape = false;
                return line.split("`").map
                (
                    function(part)
                    {
                        if (!isInInlineEscape)
                        {
                            var re = /(?:^|[^\\])\[(.*?[^\\])\]\((.*?[^\\])\)/g;
                            var match = null;
                            while(null !== (match = re.exec(part)))
                            {
                                "$".replace(/\$/g, "$$");

                                var absoluteUrl = makeAbsoluteUrl(baseUrl, match[2]);
                                var relativeUrl = makeRelativeUrl(absoluteUrl);
                                if (/.*\.md(#.*)?$/i.test(match[2]))
                                {
                                    var thisPath = location.href.split("#")[0].split("?")[0];
                                    if (thisPath !== absoluteUrl.split("#")[0].split("?")[0])
                                    {
                                        part = part.replace(new RegExp("(^|[^\\\\])" +RegExp.escape("[" +match[1] +"](" +match[2] +")")), "$1" +("[" +match[1] +"](?" +relativeUrl +")").replace(/\$/g, "$$$$"));
                                    }
                                }
                                else
                                {
                                    part = part.replace(new RegExp("(^|[^\\\\])" +RegExp.escape("[" +match[1] +"](" +match[2] +")")), "$1" +("[" +match[1] +"](" +relativeUrl +")").replace(/\$/g, "$$$$"));
                                }
                            }
                        }
                        if ("\\" !== part.substring(-1))
                        {
                            isInInlineEscape = !isInInlineEscape;
                        }
                        return part;
                    }
                ).join("`");
            }
        ).join("\n");
    };
    var translateLinkWithinPageForRemark = function(source)
    {
        var lines = source.split("\n");
        var anchors = [ ];
        var page = 1;
        var isLayout = false;
        skipEscape
        (
            lines,
            function(line)
            {
                var trimed_line = line.trim();
                if ("--" === line || "---" === line)
                {
                    if (!isLayout)
                    {
                        ++page;
                    }
                    isLayout = false;
                }
                else
                if (/^#+ [^ ]+/.test(trimed_line))
                {
                    var anchor = trimed_line.replace(/^#*/, "").trim().toLowerCase().replace(/[\!\"\#\$\%\&\'\(\)\*\+\,\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~]/g,"").replace(/ /g,"-");
                    anchors.push
                    (
                        {
                            anchor: "](#" +anchor +")",
                            page: "](#" +page +")"
                        }
                    );
                }
                else
                if ("layout:" === trimed_line.slice(0, 7) && "true" === trimed_line.slice(7).trim())
                {
                    isLayout = true;
                }
            }
        );
        return skipEscape
        (
            lines,
            function(line)
            {
                anchors.forEach
                (
                    function(i)
                    {
                        line = line.split(i.anchor).join(i.page);
                    }
                );
                return line;
            }
        ).join("\n");
    };
    var translateLinkWithinPageForReveal = function(source)
    {
        var lines = source.split("\n");
        var anchors = [ ];
        var page = 0;
        skipEscape
        (
            lines,
            function(line)
            {
                var trimed_line = line.trim();
                if ("--" === line || "---" === line)
                {
                    ++page;
                }
                else
                if (/^#+ [^ ]+/.test(trimed_line))
                {
                    var anchor = trimed_line.replace(/^#*/, "").trim().toLowerCase().replace(/[\!\"\#\$\%\&\'\(\)\*\+\,\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~]/g,"").replace(/ /g,"-");
                    anchors.push
                    (
                        {
                            anchor: "](#" +anchor +")",
                            page: "](#/" +page +")"
                        }
                    );
                }
            }
        );
        return skipEscape
        (
            lines,
            function(line)
            {
                anchors.forEach
                (
                    function(i)
                    {
                        line = line.split(i.anchor).join(i.page);
                    }
                );
                return line;
            }
        ).join("\n");
    };
    var render = function(renderer, baseUrl, source)
    {
        //  regulate return code
        source = source.replace(/\r\n/g,"\n");

        if (!renderer)
        {
            renderer = /<!--\[RENDERER\]\s*(.*?)\s*-->/.exec(source +"<!--[RENDERER]MARKDOWN-->")[1].toLowerCase();
            console.log("renderer: " +(renderer || "null"));
        }
        var isMarkdown = "markdown" === renderer;
        var isRemark = "remark" === renderer;
        var isReveal = "reveal" === renderer;
        var isEdit = "edit" === renderer;
        if (!isMarkdown && !isRemark && !isReveal && !isEdit)
        {
            var message = "Unknown Rederer Name: \"" +renderer +"\" ( Rederer Names: \"markdown\"(default), \"remark\", \"reveal\", \"edit\" )";
            showError(message);
            console.error(message);
            return;
        }

        //  conditional comment
        if (!isEdit)
        {
            source = source
                .replace(/<!--\[MD\]-->([\s\S]*?)<!--\[\/MD\]-->/g, isMarkdown ? "$1": "")
                .replace(/<!--\[NOMD\/\]([\s\S]*?)-->/g, !isMarkdown ? "$1": "")
                .replace(/<!--\[NOMD\]-->([\s\S]*?)<!--\[\/NOMD\]-->/g, !isMarkdown ? "$1": "")
                .replace(/<!--\[REMARK\/\]([\s\S]*?)-->/g, isRemark ? "$1": "")
                .replace(/<!--\[REMARK\]-->([\s\S]*?)<!--\[\/REMARK\]-->/g, isRemark ? "$1": "")
                .replace(/<!--\[NOREMARK\]-->([\s\S]*?)<!--\[\/NOREMARK\]-->/g, !isRemark ? "$1": "")
                .replace(/<!--\[REVEAL\/\]([\s\S]*?)-->/g, isReveal ? "$1": "")
                .replace(/<!--\[REVEAL\]-->([\s\S]*?)<!--\[\/REVEAL\]-->/g, isReveal ? "$1": "")
                .replace(/<!--\[NOREVEAL\]-->([\s\S]*?)<!--\[\/NOREVEAL\]-->/g, !isReveal ? "$1": "");
        }

        //  title
        var title = (source+"<!--[TITLE] -->").split("<!--[TITLE]")[1].split("-->")[0].trim();
        if ("" === title)
        {
            title = source
                .split("\n---\n")[0]
                .replace(/!\[(.*?)\]\(.*?\)/g, "")
                .replace(/\[(.*?)\]\(.*?\)/g, "$1")
                .replace(/([\W\w]*?)(#+\s+)/, "$2")
                .replace(/#+\s+(.*)([\W\w]*)/, "$1")
                .replace(/\s+/g," ")
                .replace(/<!--.*?-->/g, "")
                .replace(/<.*?>/g, "")
                .trim()
                .slice(0, 64);
        }
        document.title = title
            .replace(/&lt;/, "<")
            .replace(/&gt;/, ">");

        //  favicon
        var favicon = (source+"<!--[FAVICON] -->").split("<!--[FAVICON]")[1].split("-->")[0].trim();
        if (favicon)
        {
            appendLink
            (
                {
                    rel: "shortcut icon",
                    type: "image/x-icon",
                    href: makeRebaseUrl(baseUrl, favicon)
                }
            );
        }
        else
        {
            appendLink
            (
                {
                    rel: "shortcut icon",
                    type: "image/x-icon",
                    href: "writinghex.128.png"
                }
            );
        }

        //  theme
        var themes = (source+"<!--[THEME] -->").split("<!--[THEME]")
            .slice(1)
            .map
            (
                function(i)
                {
                    return i.split("-->")[0].trim();
                }
            )
            .filter(function(i) { return "" !== i });
        if (!isReveal)
        {
            themes.forEach
            (
                function(i)
                {
                    appendTheme(makeRebaseUrl(baseUrl, i));
                }
            );
        }

        //  style
        if (!isReveal)
        {
            var style = document.createElement("style");
            style.innerHTML = (source+"<!--[STYLE] -->").split("<!--[STYLE]")[1].split("-->")[0].trim();
            document.head.appendChild(style);
        }

        if (isMarkdown)
        {
            //  marked
            appendTheme("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css");
            if (0 === themes.length)
            {
                appendTheme("theme/default.css");
            }
            var markedScript = document.createElement("script");
            markedScript.src = "js/marked.js";
            markedScript.onload = function()
            {
                var config = JSON.parse((source+"<!--[MARKED-CONFIG] { } -->").split("<!--[MARKED-CONFIG]")[1].split("-->")[0].trim());
                console.log("marked-config: " +JSON.stringify(config, null, 4));
                var markedRenderer = new marked.Renderer();
                markedRenderer.heading = function (text, level, raw)
                {
                    return '<h'
                    + level
                    + ' id="'
                    + this.options.headerPrefix
                    + raw.toLowerCase().replace(/[\!\"\#\$\%\&\'\(\)\*\+\,\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~]/g,"").replace(/ /g,"-")
                    + '">'
                    + text
                    + '</h'
                    + level
                    + '>\n';
                };
                config.renderer = markedRenderer;
                marked.setOptions(config);

                document.body.className = "marked";

                var wallPaper = (source+"<!--[WALLPAPER] -->").split("<!--[WALLPAPER]")[1].split("-->")[0].trim();
                if (wallPaper)
                {
                    document.body.className += " with-wallpaper";
                    var wallPaperDiv = document.createElement("div");
                    wallPaperDiv.className = "wallpaper";
                    wallPaperDiv.style.backgroundImage = "url(\"" +makeRebaseUrl(baseUrl, wallPaper) +"\")";
                    document.body.appendChild(wallPaperDiv);
                }
                
                var withIndex = true;
                var index = null;
                if (withIndex)
                {
                    document.body.className += " with-index";

                    var indexDiv = document.createElement("div");
                    indexDiv.className = "index";
                    index = makeIndexForMarked(source);
                    index.forEach
                    (
                        function(i)
                        {
                            var a = document.createElement("a");
                            i.anchor = a;
                            a.className = "level" + i.level;
                            a.href = i.link;
                            a.innerText = i.title;
                            indexDiv.appendChild(a);
                        }
                    );
                    var indexFrameDiv = document.createElement("div");
                    indexFrameDiv.className = "index-frame";
                    indexFrameDiv.appendChild(indexDiv);
                    document.body.appendChild(indexFrameDiv);

                    indexDiv.onmouseenter = function() { globalState.isMouseOnIndex = true; };
                    indexDiv.onmouseleave = function() { globalState.isMouseOnIndex = false; };
                }

                var contentDiv = document.createElement("div");
                contentDiv.innerHTML = marked
                (
                    skipEscape
                    (
                        translateRelativeLink(baseUrl, source).split("\n"),
                        function(line)
                        {
                            return line
                                .replace(/\\</g, "&lt;")
                                .replace(/\\>/g, "&gt;")
                                .replace(/\\\\/g, "\\");
                        }
                    ).join("\n")
                    .replace(/\n\$\$\n([\W\w]*?)\n\$\$\n/g, "\n<pre class=\"mathjax\">\n$$$$\n$1\n$$$$\n</pre>\n")
                );
                contentDiv.className = "content";
                if (withIndex)
                {
                    var spacerDiv = document.createElement("div");
                    spacerDiv.style.height = "90vh";
                    contentDiv.appendChild(spacerDiv);
                }
                document.body.appendChild(contentDiv);

                //  highlight
                var highlightScript = document.createElement("script");
                highlightScript.src = "//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js";
                highlightScript.onload = function()
                {
                    hljs.initHighlightingOnLoad();
                    document.querySelectorAll("code").forEach
                    (
                        function(element)
                        {
                            //  highlightjs が知らない言語が指定されてるとなにも実行されなくなるので指定を消すなり類似した言語に変換する
                            switch(element.className)
                            {
                                case "lang-cmd":
                                    element.className = "lang-shell";
                                    break;
                            }

                            return hljs.highlightBlock(element);
                        }
                    );

                    var fragmentId = decodeURI((location.href +"#").split("#")[1].trim());
                    if (fragmentId)
                    {
                        location.href = "#" +fragmentId;
                    }

                    if (index)
                    {
                        var previousState = { i: 0 }; // 本来は -1 で初期化するべきだが、それだと後ろの setTimeout(contentDiv.onscroll, 0); による初期表示が意図通りに機能しないので 0 にしてる。 
                        var isOver = function(i)
                        {
                            return index.length <= i ||
                                    (0 <= i && 32 < document.getElementById(index[i].link.substring(1)).getBoundingClientRect().top);
                        }
                        var previousContent = null;
                        for(var i in index)
                        {
                            var content = document.getElementById(index[i].link.substring(1));
                            if (!content)
                            {
                                console.log("not found: " +index[i].link);
                                index[i].withError = true;
                            }
                            else
                            if (previousContent && content.getBoundingClientRect().top < previousContent.getBoundingClientRect().top)
                            {
                                console.log("may be duplicated id: " +index[i].link);
                                index[i].withError = true;
                            }
                            if (!index[i].withError)
                            {
                                previousContent = content;
                            }
                        }
                        index = index.filter(function(i) { return !i.withError });

                        contentDiv.onscroll = function()
                        {
                            var previouseContetIsOver = isOver(previousState.i);
                            var nextContetIsOver = isOver(previousState.i +1);
                            if (previouseContetIsOver || !nextContetIsOver)
                            {
                                var i = null;
                                if (previouseContetIsOver)
                                {
                                    //  上へ手繰る
                                    while(isOver(--previousState.i)) { }
                                }
                                else
                                {
                                    // 下へ手繰る
                                    while(!isOver((++previousState.i) +1)) { }
                                }
                                var targetIndex = previousState.i < 0 ? null: index[previousState.i];
                                var current = document.getElementsByClassName("current")[0];
                                if (current !== (null === targetIndex ? null: targetIndex.anchor))
                                {
                                    if (current)
                                    {
                                        current.classList.remove("current");
                                    }
                                    if (targetIndex)
                                    {
                                        targetIndex.anchor.classList.add("current");
                                        window.history.replaceState(null, targetIndex.title, targetIndex.link);
                                    }
                                    else
                                    {
                                        index[0].anchor.classList.add("current");
                                        window.history.replaceState(null, document.title, "#");
                                    }
                                    if (!globalState.isMouseOnIndex)
                                    {
                                        var frame = document.getElementsByClassName("index-frame")[0];
                                        if (null === targetIndex)
                                        {
                                            frame.scrollTop = 0;
                                        }
                                        else
                                        {
                                            var rect = targetIndex.anchor.getBoundingClientRect();
                                            var targetTop = rect.top +frame.scrollTop;
                                            frame.scrollTop = targetTop - Math.min(frame.clientHeight -rect.height, ((targetTop / frame.scrollHeight) *frame.clientHeight));
                                        }
                                    }
                                }
                            }
                        };
                        setTimeout(contentDiv.onscroll, 0);
                    }

                    //  MathJax
                    var mathjaxScript = document.createElement("script");
                    mathjaxScript.src = "//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML";
                    document.head.appendChild(mathjaxScript);
                };
                document.head.appendChild(highlightScript);
            };
            document.head.appendChild(markedScript);
        }
        if (isRemark)
        {
            //  remark
            var script = document.createElement("script");
            script.src = "js/remark-latest.min.js";
            script.onload = function()
            {
                var config = JSON.parse((source+"<!--[REMARK-CONFIG] { } -->").split("<!--[REMARK-CONFIG]")[1].split("-->")[0].trim());
                config.source = translateLinkWithinPageForRemark(source);
                var slideshow = remark.create(config);
            };
            document.head.appendChild(script);
        }
        if (isReveal)
        {
            //  reveal
            appendTheme("css/reveal.css");
            var revealTheme = /<!--\[REVEAL-THEME\]\s*(.*?)\s*-->/.exec(source +"<!--[REVEAL-THEME]league-->")[1].toLowerCase();
            console.log("reveal-theme: " +revealTheme);
            appendTheme("css/theme/" +revealTheme +".css", "theme");
            var documentTheme = document.getElementById("theme");
            appendTheme("lib/css/zenburn.css");
            appendTheme(window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css');
            if (0 === themes.length)
            {
                appendTheme("theme/default.css");
            }

            themes.forEach
            (
                function(i)
                {
                    appendTheme(makeRebaseUrl(baseUrl, i));
                }
            );
            var style = document.createElement("style");
            style.innerHTML = (source+"<!--[STYLE] -->").split("<!--[STYLE]")[1].split("-->")[0].trim();
            document.head.appendChild(style);

            //  paste markdown
            var separator = (source+"<!--[REVEAL-SEPARATOR] ^\\n---$ -->").split("<!--[REVEAL-SEPARATOR]")[1].split("-->")[0].trim();
            var separator_vertical = (source+"<!--[REVEAL-SEPARATOR-VERTICAL] ^\\n>>>$ -->").split("<!--[REVEAL-SEPARATOR-VERTICAL]")[1].split("-->")[0].trim();
            var separator_notes = (source+"<!--[REVEAL-SEPARATOR-NOTES] ^Note: -->").split("<!--[REVEAL-SEPARATOR-NOTES]")[1].split("-->")[0].trim();
            var pasteMarkdown = function(markdown)
            {
                var div = document.createElement("div");
                div.className = "reveal";
                div.innerHTML =
                    "<div class=\"slides\">"
                        +"<section id=\"source-markdown\" data-markdown>"
                            +"<script type=\"text/template\">"
                                +markdown
                            +"</" +"script>"
                        +"</section>"
                    +"</div>";
                document.body.appendChild(div);
                var section = document.getElementById("source-markdown");
                section.setAttribute("data-separator", separator);
                section.setAttribute("data-separator-vertical", separator_vertical);
                section.setAttribute("data-separator-notes", separator_notes);
                section.removeAttribute("id");
            };
            pasteMarkdown(translateLinkWithinPageForReveal(source));
            var headScript = document.createElement("script");
            headScript.src = "lib/js/head.min.js";
            headScript.onload = function()
            {
                var script = document.createElement("script");
                script.src = "js/reveal.js";
                script.onload = function()
                {
                    var revealTransition = /<!--\[REVEAL-TRANSITION\]\s*(.*?)\s*-->/.exec(source +"<!--[REVEAL-TRANSITION]concave-->")[1].toLowerCase();
                    console.log("reveal-transition: " +revealTransition);
                    console.log("reveal-theme(forced by url param): " +Reveal.getQueryHash().theme);
                    console.log("reveal-transition(forced by url param): " +Reveal.getQueryHash().transition);
                    var forceTheme = Reveal.getQueryHash().theme;
                    if (forceTheme)
                    {
                        documentTheme.href = "css/theme/" +forceTheme +".css";
                    }
                    // More info about config & dependencies:
                    // - https://github.com/hakimel/reveal.js#configuration
                    // - https://github.com/hakimel/reveal.js#dependencies
                    var config = JSON.parse((source+"<!--[REVEAL-CONFIG] { } -->").split("<!--[REVEAL-CONFIG]")[1].split("-->")[0].trim());
                    console.log("reveal-config: " +JSON.stringify(config, null, 4));
                    var defaultConfig =
                    {
                        controls: true,
                        progress: true,
                        history: true,
                        center: true,
                        transition: Reveal.getQueryHash().transition || revealTransition, 
                        dependencies:
                        [
                            { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                            { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                            { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                            { src: 'plugin/highlight/highlight.js', async: true, callback: function() {
                                hljs.initHighlightingOnLoad();
                                document.querySelectorAll('code').forEach(hljs.highlightBlock);
                            } },
                            { src: 'plugin/search/search.js', async: true },
                            { src: 'plugin/zoom-js/zoom.js', async: true },
                            { src: 'plugin/notes/notes.js', async: true }
                        ]
                    };
                    Reveal.initialize(objectAssign(defaultConfig, config));
                };
                document.head.appendChild(script);
            };
            document.head.appendChild(headScript);
        }
        if (isEdit)
        {
            //  edit
            document.body.style.margin = "0";
            document.body.style.overflow = "hidden";
            document.body.style.backgroundColor = "#86812A";
            var urlsDiv = document.createElement("div");
            urlsDiv.style.padding = "0.5rem 1.0rem";
            urlsDiv.style.width = "100%";
            urlsDiv.style.height = "1rem";
            urlsDiv.style.verticalAlign = "middle";
            urlsDiv.style.lineHeight = "1rem";
            var textCounter = document.createElement("span");
            textCounter.style.color = "#CCCCCC";
            textCounter.style.padding = "0rem 1.0rem";
            urlsDiv.appendChild(textCounter);
            var defaultLink = document.createElement("a");
            defaultLink.style.color = "#FFFFFF";
            defaultLink.style.padding = "0rem 1.0rem";
            defaultLink.text = "default";
            defaultLink.target = "_blank";
            urlsDiv.appendChild(defaultLink);
            var markedLink = document.createElement("a");
            markedLink.style.color = "#FFFFFF";
            markedLink.style.padding = "0rem 1.0rem";
            markedLink.text = "marked(markdown)";
            markedLink.target = "_blank";
            urlsDiv.appendChild(markedLink);
            var remarkLink = document.createElement("a");
            remarkLink.style.color = "#FFFFFF";
            remarkLink.style.padding = "0rem 1.0rem";
            remarkLink.text = "remark(slide)";
            remarkLink.target = "_blank";
            urlsDiv.appendChild(remarkLink);
            var revealLink = document.createElement("a");
            revealLink.style.color = "#FFFFFF";
            revealLink.style.padding = "0rem 1.0rem";
            revealLink.text = "reveal(slide)";
            revealLink.target = "_blank";
            urlsDiv.appendChild(revealLink);
            var editLink = document.createElement("a");
            editLink.style.color = "#FFFFFF";
            editLink.style.padding = "0rem 1.0rem";
            editLink.text = "edit";
            editLink.target = "_blank";
            urlsDiv.appendChild(editLink);
            document.body.appendChild(urlsDiv);
            var textarea = document.createElement("textarea");
            textarea.style.width = "100%";
            textarea.style.width = "calc(100vw - 2rem)";
            textarea.style.height = "100%";
            textarea.style.height = "calc(100vh - 3rem)";
            textarea.style.margin = "0rem 1rem 1rem 1rem";
            textarea.value = source;
            document.body.appendChild(textarea);
            var update = function() {
                var text = encodeURIComponent(textarea.value);
                textCounter.innerText = "lenght:" +text.length;
                defaultLink.href = "?text:" +text;
                markedLink.href = "?markdown&text:" +text;
                remarkLink.href = "?remark&text:" +text;
                revealLink.href = "?reveal&text:" +text;
                editLink.href = "?edit&text:" +text;
            };
            update();
            textarea.addEventListener("change",update);
            textarea.addEventListener("keyup",update);
        }
    };
    var renderer = null; 
    var sourceUrl = null;
    var urlArgs = (location.href.split("#")[0] +"?")
        .split("?")[1]
        .split("&")
        .filter(function(i) { return i.indexOf("=") < 0 })
        .map(function(i) { return unescape(decodeURI(i));});
    if (1 <= urlArgs.length)
    {
        if (2 <= urlArgs.length)
        {
            renderer = urlArgs[0];
            sourceUrl = urlArgs[1];
        }
        else
        {
            sourceUrl = urlArgs[0];
        }
        sourceUrl = sourceUrl
            .replace(/^(?:https\:)?\/\/github\.com\/([^/]+\/[^/]+)\/?(#.*)?$/, "https://github.com/$1/blob/master/README.md")
            .replace(/^(?:https\:)?\/\/github\.com\/([^/]+\/[^/]+)\/blob\/(.*\.md)(#.*)?$/, "https://raw.githubusercontent.com/$1/$2");
    }
    if (!sourceUrl)
    {
        sourceUrl = "index.md";
    }
    console.log("renderer(forced by url param): " +(renderer || "null"));
    console.log("loading: " +sourceUrl);
    if ("text:" === sourceUrl.slice(0, 5))
    {
        setTimeout(function(){
            render(renderer, location.href, sourceUrl.slice(5));
        }, 1); // 0 だと document.body が null だと怒られることがある。
    }
    else
    {
        var request = window.XMLHttpRequest ? new XMLHttpRequest(): new ActiveXObject("Microsoft.XMLHTTP");
        request.open('GET', sourceUrl, true);
        request.onreadystatechange = function()
        {
            if (4 === request.readyState)
            {
                if (200 <= request.status && request.status < 300)
                {
                    render(renderer, makeAbsoluteUrl(location.href, sourceUrl), request.responseText);
                }
                else
                {
                    showError("loading failed: { \"method\": \"GET\", \"url\": \"<a href=\"" +sourceUrl.replace(/\"/g, "%25") +" \" style=\"color: #6666FF;\">" + sourceUrl.replace(/</g, "&lt;").replace(/>/g, "&gt;") +"</a>\", \"status\": "+ request.status + "};");
                    document.body.appendChild(errorDiv);
                    var responseDiv = document.createElement("div");
                    if (request.responseText)
                    {
                        responseDiv.innerHTML = request.responseText;
                    }
                    else
                    {
                        responseDiv.style = "white-space: pre-wrap; font-size: 1.5rem; padding: 20px;"
                        if (0 === request.status)
                        {
                            responseDiv.innerText = "There ia a possibility that server not found or it happened cross-domain issue.\nサーバーが見つからないかクロスドメインの問題が発生した可能性があります。";
                        }
                        else
                        {
                            responseDiv.innerText = JSON.stringify(request.getAllResponseHeaders(), null, 4);
                        }
                    }
                    document.body.appendChild(responseDiv);
                }
            }
        };
        request.send(null);
    }
})();
</script>
