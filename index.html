<meta charset="utf-8">
<!--
このファイルのライセンスは Boost Software License, Version 1.0. ( http://www.boost.org/LICENSE_1_0.txt ) とします。
-->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-117326573-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-117326573-1');
</script>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@wraith13">
<meta name="twitter:title" content="writing" id="twitter-card-title">
<meta name="twitter:description" content="ドキュメント公開サイト">
<meta name="twitter:image" content="https://wraith13.github.io/writing/writinghex.128.png" id="twitter-card-image">
<script type="text/x-mathjax-config">
MathJax.Hub.Config
(
    {
        tex2jax:
        {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            skipTags: ["script","noscript","style","textarea","code", "a"]
        },
        asciimath2jax:
        {
            skipTags: ["script","noscript","style","textarea","code", "a"]
        }
    }
);
</script>
<body><div id="writing-HTML-selfloading-error">
# Error

なんからの手違いで writing のレンダリングシステムを markdown ソースとして読み込んでしまっているか、あるいは JavaScript が正常に動作していません。

<!--[THEME] theme/default.css -->
</div><script>
'use strict';
(function()
{
    document.body.removeChild(document.getElementById("writing-HTML-selfloading-error"));

    var globalState = { };
    var explicitFragmentIdPattern = /\{\#(.*?)\}$/;

    RegExp.escape = function(s)
    {
        //  https://stackoverflow.com/questions/3561493/is-there-a-regexp-escape-function-in-javascript
        return s.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
    };
    var objectAssign = function(target, source)
    {
        //  copy from https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Object/assign#Polyfill
        if (typeof Object.assign !== 'function') {
            (function () {
                Object.assign = function (target) {
                'use strict';
                if (target === undefined || target === null) {
                    throw new TypeError('Cannot convert undefined or null to object');
                }
                var output = Object(target);
                for (var index = 1; index < arguments.length; index++) {
                    var source = arguments[index];
                    if (source !== undefined && source !== null) {
                        for (var nextKey in source) {
                            if (Object.prototype.hasOwnProperty.call(source, nextKey)) {
                                output[nextKey] = source[nextKey];
                            }
                        }
                    }
                }
                return output;
                };
            })();
        }

        Object.assign(target, source);
        return target;
    };
    var deepCopy = function(source)
    {
        return JSON.parse(JSON.stringify(source));
    };
    var recursiveAssign = function(target, source)
    {
        for(var key in source)
        {
            if (source.hasOwnProperty(key))
            {
                var value = source[key];
                if ("object" === practicalTypeof(value))
                {
                    if (undefined === target[key])
                    {
                        target[key] = { };
                    }
                    recursiveSet(target[key], value);
                }
                else
                {
                    target[key] = value;
                }
            }
        }
    };
    var practicalTypeof = function(obj)
    {
        if (undefined === obj)
        {
            return "undefined";
        }
        if (null === obj)
        {
            return "null";
        }
        if ("[object Array]" === Object.prototype.toString.call(obj))
        {
            return "array";
        }

        return typeof obj;
    }
    var makeDomNode = function(arg)
    {
        if (arg instanceof Node)
        {
            return arg;
        }
        if ("string" === practicalTypeof(arg))
        {
            return document.createTextNode(arg);
        }
        return setToElement(document.createElement(arg.tag), arg);
    };
    var setToElement = function(element, arg)
    {
        for(var key in arg)
        {
            if (arg.hasOwnProperty(key))
            {
                switch(key)
                {
                case "tag":
                case "parent":
                case "children":
                case "attributes":
                case "eventListener":
                    //  nop
                    break;
                default:
                    var value = arg[key];
                    if (undefined !== value)
                    {
                        if ("object" === practicalTypeof(value))
                        {
                            recursiveAssign(element[key], value);
                        }
                        else
                        {
                            element[key] = value;
                        }
                    }
                    break;
                }
            }
        }
        if (undefined !== arg.attributes)
        {
            for(var key in arg.attributes)
            {
                if (arg.attributes.hasOwnProperty(key))
                {
                    element.setAttribute(key, arg.attributes[key]);
                    //  memo: value を持たない attribute を設定したい場合には value として "" を指定すれば良い。
                }
            }
        }
        if (undefined !== arg.children)
        {
            if ("array" === practicalTypeof(arg.children))
            {
                arg.children.forEach
                (
                    function(i)
                    {
                        element.appendChild(makeDomNode(i));
                    }
                );
            }
            else
            {
                element.appendChild(makeDomNode(arg.children));
            }
        }
        if (undefined !== arg.eventListener)
        {
            for(var key in arg.eventListener)
            {
                if (arg.eventListener.hasOwnProperty(key))
                {
                    element.addEventListener(key, arg.eventListener[key]);
                }
            }
       }
        if (undefined !== arg.parent)
        {
            arg.parent.appendChild(element);
        }
        return element;
    };
    var showError = function(arg)
    {
        recursiveAssign
        (
            document.body.style,
            {
                margin: "0px",
            }
        );
        makeDomNode
        (
            {
                parent: document.body,
                tag: "div",
                style:
                {
                    color: "#AA3322",
                    backgroundColor: "#442211",
                    fontSize: "1.5rem",
                    padding: "0.4rem",
                    textAlign: "center",
                },
                children: arg,
            }
        );
    };
    var appendLink = function(args)
    {
        makeDomNode
        (
            objectAssign
            (
                deepCopy(args),
                {
                    parent: document.head,
                    tag: "link"
                }
            )
        );
    };
    var appendTheme = function(href, id)
    {
        appendLink
        (
            {
                rel: "stylesheet",
                type: "text/css",
                href: href,
                id: id
            }
        );
    };
    var appendIcon = function(href)
    {
        appendLink
        (
            {
                rel: "shortcut icon",
                type: "image/x-icon",
                href: href,
            }
        );
        appendLink
        (
            {
                rel: "apple-touch-icon",
                type: undefined,
                href: href,
            }
        );
        document.getElementById("twitter-card-image").content = href;
    };
    var loadScript = function(src, onload)
    {
        makeDomNode
        (
            {
                parent: document.head,
                tag: "script",
                src: src,
                onload: onload,
            }
        );
    };
    var makeAbsoluteUrl = function(base, url)
    {
        if ("#" === url.substr(0, 1))
        {
            return base.split("#")[0] +url;
        }
        var baseParts = base.split("?")[0].split("/");
        if (4 <= baseParts.length && "" !== baseParts[baseParts.length -1])
        {
            // ファイル名部分の除去
            baseParts = baseParts.slice(0, -1);
        }
        if (4 <= baseParts.length && "" === baseParts[baseParts.length -1])
        {
            // 末尾の空要素を除去(しておかないと結合時に余分に / が挟まる)
            baseParts = baseParts.slice(0, -1);
        }
        var urlParts = url.split("/");
        if (0 <= urlParts[0].indexOf(":"))
        {
            //  絶対パスなので base 側は全て破棄
            baseParts = [];
        }
        else
        {
            if ("" === urlParts[0])
            {
                urlParts = urlParts.slice(1);
                if ("" === urlParts[0])
                {
                    //  プロトコルだけ利用
                    baseParts = baseParts.slice(0, 1);
                }
                else
                {
                    //  サーバー名まで利用
                    baseParts = baseParts.slice(0, 3);
                }
            }
            else
            {
                while(true)
                {
                    if ("." === urlParts[0])
                    {
                        urlParts = urlParts.slice(1);
                        continue;
                    }
                    if (".." === urlParts[0])
                    {
                        urlParts = urlParts.slice(1);
                        if (4 <= baseParts.length)
                        {
                            baseParts = baseParts.slice(0, -1);
                        }
                        continue;
                    }
                    break;
                }
            }
        }
        return baseParts.concat(urlParts).join("/");
    };
    var makeRelativeUrl = function(url)
    {
        var base = location.href.split("#")[0];
        if ("#" === url.substr(0, 1))
        {
            return base.split("#")[0] +url;
        }
        if (location.href.split("#")[0] === url.split("#")[0])
        {
            return url;
        }
        var baseParts = base.split("?")[0].split("/");
        if (4 <= baseParts.length && "" !== baseParts[baseParts.length -1])
        {
            // ファイル名部分の除去
            baseParts = baseParts.slice(0, -1);
        }
        if (4 <= baseParts.length && "" === baseParts[baseParts.length -1])
        {
            // 末尾の空要素を除去(しておかないと結合時に余分に / が挟まる)
            baseParts = baseParts.slice(0, -1);
        }
        var urlParts = url.split("/");
        var matchLength = 0;
        while(0 < baseParts.length && 0 < urlParts.length && baseParts[matchLength] === urlParts[matchLength])
        {
            ++matchLength;
        }
        switch(matchLength)
        {
        case 0:
            break;
        case 1: // 1 になることは通常あり得なくて 1 になることがあるとしたら恐らくどこかのバグ
        case 2:
            urlParts = [""].concat(urlParts.slice(1));
            break;
        default:
            urlParts = urlParts.slice(matchLength);
            break;
        }
        var result = urlParts.join("/");
        if ("" === result)
        {
            result = ".";
        }
        return result;
    };
    var makeRebaseUrl = function(base, url)
    {
        if ("#" === url.substr(0, 1))
        {
            return url;
        }
        return makeRelativeUrl(makeAbsoluteUrl(base, url));
    };
    var skipEscape = function(lines, map)
    {
        var currentEscape = null;
        return lines.map
        (
            function(line)
            {
                var escape = "$$" === line.trim() ? "$$": line.trim().replace(/^(```+|~~~+).*/, "$1").replace(/^[`~]{0,2}(([^`~].*)|$)/,"");
                var isEscape = null === currentEscape && ("" !== escape) || (null !== currentEscape && currentEscape.substr(0,1) === escape.substr(0,1) && currentEscape.length <= escape.length);
                if (isEscape)
                {
                    if (null === currentEscape)
                    {
                        currentEscape = escape;
                    }
                    else
                    {
                        // ここでこういう処理を挟むのは行儀が悪いけど、閉じが長すぎる場合にここで整形してしまう。
                        line = currentEscape;

                        currentEscape = null;
                    }
                }
                else
                if (null === currentEscape)
                {
                    line = map(line);
                }
                return line;
            }
        );
    };
    var markdownHeaderFragmentMaker = function()
    {
        this.links = [];
        this.makeFragment = function(line) {
            var explicitFragmentIdMatch = line.match(explicitFragmentIdPattern);
            var link = explicitFragmentIdMatch ?
                explicitFragmentIdMatch[1]:
                line
                    .replace(/^#*/, "")
                    .replace(/!\[(.*?)\]\(.*?\)/g, "$1")
                    .replace(/\[(.*?)\]\(.*?\)/g, "$1")
                    .replace(/(^|[^\\])<[^\>]*?[^\\]>/g, "$1") // エスケープを避けつつ適切に処理する為にはこの置換は2回行う必要がある。(3回は必要ない2回で十分)
                    .replace(/(^|[^\\])<[^\>]*?[^\\]>/g, "$1")
                    .trim()
                    .toLowerCase()
                    .replace(/[\!\"\#\$\%\&\'\(\)\*\+\,\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~]/g,"")
                    .replace(/ /g,"-");
            var index = this.links[link];
            if (undefined === index)
            {
                this.links[link] = 0;
                return link;
            }
            else
            {
                ++index;
                this.links[link] = index;
                return link +"-" +index;
            }
        }
    };
    var makeIndexForMarked = function(source)
    {
        var linkMaker = new markdownHeaderFragmentMaker();
        var anchors = [ ];
        skipEscape
        (
            source.split("\n"),
            function(line)
            {
                var trimed_line = line;
                if (/^#+ [^ ]+/.test(trimed_line))
                {
                    var title = trimed_line
                        .replace(/^#* /, "")
                        .replace(/!\[.*?\]\(.*?\)/g, "")
                        .replace(/\[(.*?)\]\(.*?\)/g, "$1")
                        .replace(/(^|[^\\])<[^\>]*?[^\\]>/g, "$1") // エスケープを避けつつ適切に処理する為にはこの置換は2回行う必要がある。(3回は必要ない2回で十分)
                        .replace(/(^|[^\\])<[^\>]*?[^\\]>/g, "$1")
                        .replace(/\\\!/g,"!")
                        .replace(/\\\"/g,"\"")
                        .replace(/\\\#/g,"#")
                        .replace(/\\\$/g,"$")
                        .replace(/\\\%/g,"%")
                        .replace(/\\\&/g,"&")
                        .replace(/\\\'/g,"'")
                        .replace(/\\\(/g,"(")
                        .replace(/\\\)/g,")")
                        .replace(/\\\*/g,"*")
                        .replace(/\\\+/g,"+")
                        .replace(/\\\,/g,",")
                        .replace(/\\\./g,".")
                        .replace(/\\\//g,"/")
                        .replace(/\\\:/g,":")
                        .replace(/\\\;/g,";")
                        .replace(/\\\</g,"<")
                        .replace(/\\\=/g,"=")
                        .replace(/\\\>/g,">")
                        .replace(/\\\?/g,"?")
                        .replace(/\\\@/g,"@")
                        .replace(/\\\[/g,"[")
                        .replace(/\\\\/g,"\\")
                        .replace(/\\\]/g,"]")
                        .replace(/\\\^/g,"^")
                        .replace(/\\\_/g,"_")
                        .replace(/\\\`/g,"`")
                        .replace(/\\\{/g,"{")
                        .replace(/\\\|/g,"|")
                        .replace(/\\\}/g,"}")
                        .replace(/\\\~/g,"~")
                        .trim()
                        .replace(explicitFragmentIdPattern, "");
                    var level = (trimed_line.trim().length -trimed_line.replace(/^#*/, "").trim().length) -1;
                    //var link = "#" +trimed_line.replace(/^#*/, "").replace(/!\[(.*?)\]\(.*?\)/g, "$1").replace(/\[(.*?)\]\(.*?\)/g, "$1").trim().toLowerCase().replace(/[\!\"\#\$\%\&\'\(\)\*\+\,\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~]/g,"").replace(/ /g,"-");
                    var link = "#" +linkMaker.makeFragment(trimed_line);
                    anchors.push
                    (
                        {
                            level: level,
                            title: title,
                            link: link
                        }
                    );
                }
            }
        );
        return anchors;
    };
    var translateRelativeUrl = function(baseUrl, url)
    {
        if ("?" === url.substr(0, 1))
        {
            return url +"&" +encodeURIComponent(makeRelativeUrl(baseUrl));
        }
        else
        if ("#" !== url.substr(0, 1))
        {
            var absoluteUrl = makeAbsoluteUrl(baseUrl, url);
            var relativeUrl = makeRelativeUrl(absoluteUrl);
            if (/.*\.md(\.txt)?(#.*)?$/i.test(absoluteUrl))
            {
                var thisPath = location.href.split("#")[0].split("?")[0];
                if (thisPath !== absoluteUrl.split("#")[0].split("?")[0])
                {
                    return "?" +encodeURIComponent(relativeUrl);
                }
            }
            else
            {
                return relativeUrl;
            }
        }
        return url;
    }
    var translateRelativeLink = function(baseUrl, source)
    {
        return skipEscape
        (
            source.split("\n"),
            function(line)
            {
                var isInInlineEscape = false;
                var isInSquareBracket = false;
                return line.split("`").map
                (
                    function(part)
                    {
                        if (!isInInlineEscape)
                        {
                            var match = null;

                            if (isInSquareBracket)
                            {
                                isInSquareBracket = false;
                                var re = /(.*?[^\\])?\]\((.*?[^\\])\)/g;
                                if (null !== (match = re.exec(part)))
                                {
                                    var label = undefined === match[1] ? "": match[1];
                                    var url = match[2];
                                    var traslatedUrl = translateRelativeUrl(baseUrl, url);
                                    if (url !== traslatedUrl)
                                    {
                                        part = part.replace(match[0], label +"](" +traslatedUrl +")");
                                    }
                                }
                            }

                            var re = /(^|[^\\])\[(.*?[^\\])?\]\((.*?[^\\])\)/g;
                            while(null !== (match = re.exec(part)))
                            {
                                var label = undefined === match[2] ? "": match[2];
                                var url = match[3];
                                var traslatedUrl = translateRelativeUrl(baseUrl, url);
                                if (url !== traslatedUrl)
                                {
                                    part = part.replace(match[0], match[1] +"[" +label +"](" +traslatedUrl +")");
                                }
                            }
                            if (/(^|[^\\])\]/.test(part))
                            {
                                isInSquareBracket = false;
                            }
                            if (/\[([^\]]|\\\])*$/.test(part))
                            {
                                isInSquareBracket = true;
                            }

                            var img_re = /\<(\s*)img(\s.*?)src=([\"\'])(.*?)([\"\'].*?)\>/g;
                            while(null !== (match = img_re.exec(part)))
                            {
                                var url = match[4];
                                var absoluteUrl = makeAbsoluteUrl(baseUrl, url);
                                var relativeUrl = makeRelativeUrl(absoluteUrl);
                                part = part.replace(match[0], "<" +match[1] +"img" +match[2] +"src=" +match[3] +relativeUrl +match[5] +">");
                            }
                        }
                        if ("\\" !== part.substring(-1))
                        {
                            isInInlineEscape = !isInInlineEscape;
                        }
                        return part;
                    }
                ).join("`");
            }
        ).join("\n");
    };
    var translateLinkWithinPageForRemark = function(source)
    {
        var lines = source.split("\n");
        var anchors = [ ];
        var page = 1;
        var isLayout = false;
        skipEscape
        (
            lines,
            function(line)
            {
                var trimed_line = line.trim();
                if ("--" === line || "---" === line)
                {
                    if (!isLayout)
                    {
                        ++page;
                    }
                    isLayout = false;
                }
                else
                if (/^#+ [^ ]+/.test(trimed_line))
                {
                    var anchor = trimed_line.replace(/^#*/, "").trim().toLowerCase().replace(/[\!\"\#\$\%\&\'\(\)\*\+\,\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~]/g,"").replace(/ /g,"-");
                    anchors.push
                    (
                        {
                            anchor: "](#" +anchor +")",
                            page: "](#" +page +")"
                        }
                    );
                }
                else
                if ("layout:" === trimed_line.slice(0, 7) && "true" === trimed_line.slice(7).trim())
                {
                    isLayout = true;
                }
            }
        );
        return skipEscape
        (
            lines,
            function(line)
            {
                anchors.forEach
                (
                    function(i)
                    {
                        line = line.split(i.anchor).join(i.page);
                    }
                );
                return line;
            }
        ).join("\n");
    };
    var translateLinkWithinPageForReveal = function(source)
    {
        var lines = source.split("\n");
        var anchors = [ ];
        var page = 0;
        skipEscape
        (
            lines,
            function(line)
            {
                var trimed_line = line.trim();
                if ("--" === line || "---" === line)
                {
                    ++page;
                }
                else
                if (/^#+ [^ ]+/.test(trimed_line))
                {
                    var anchor = trimed_line.replace(/^#*/, "").trim().toLowerCase().replace(/[\!\"\#\$\%\&\'\(\)\*\+\,\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~]/g,"").replace(/ /g,"-");
                    anchors.push
                    (
                        {
                            anchor: "](#" +anchor +")",
                            page: "](#/" +page +")"
                        }
                    );
                }
            }
        );
        return skipEscape
        (
            lines,
            function(line)
            {
                anchors.forEach
                (
                    function(i)
                    {
                        line = line.split(i.anchor).join(i.page);
                    }
                );
                return line;
            }
        ).join("\n");
    };
    var translateForSlide = function(source)
    {
        var autoPageSeparate = /<!--\[AUTOPAGESEPARATE\]\s*(.*?)\s*-->/.exec(source +"<!--[AUTOPAGESEPARATE] auto -->")[1].toLowerCase();
        console.log("autoPageSeparate: " +autoPageSeparate);
        if ("true" === autoPageSeparate || ("false" !== autoPageSeparate && !/\n---\n/.test(source)))
        {
            var lines = source.split("\n");
            var h1Count = 0;
            skipEscape
            (
                lines,
                function(line)
                {
                    var trimed_line = line.trim();
                    if (/^# [^ ]+/.test(trimed_line))
                    {
                        ++h1Count;
                    }
                }
            );

            var isFirst = true;
            var withJackUp = 1 < h1Count;
            return skipEscape
            (
                lines,
                function(line)
                {
                    var trimed_line = line.trim();
                    if (/^#+ [^ ]+/.test(trimed_line))
                    {
                        if (!isFirst)
                        {
                            if (withJackUp)
                            {
                                line = "#" +trimed_line;
                            }
                            line = "---\n" + line;
                        }
                        isFirst = false;
                    }
                    return line;
                }
            ).join("\n");
        }
        else
        {
            return source;
        }
    };
    var applyTitle = function(source)
    {
        var title = (source+"<!--[TITLE] -->").split("<!--[TITLE]")[1].split("-->")[0].trim();
        if ("" === title)
        {
            title = source
                .split("\n---\n")[0]
                .replace(/!\[(.*?)\]\(.*?\)/g, "")
                .replace(/\[(.*?)\]\(.*?\)/g, "$1")
                .replace(/([\W\w]*?)(#+\s+)/, "$2")
                .replace(/#+\s+(.*)([\W\w]*)/, "$1")
                .replace(/\s+/g," ")
                .replace(/<!--.*?-->/g, "")
                .replace(/<.*?>/g, "")
                .trim()
                .slice(0, 64);
        }
        document.title = title
            .replace(/&lt;/, "<")
            .replace(/&gt;/, ">");
        document.getElementById("twitter-card-title").content = title;
    };
    var applyIcon = function(baseUrl, source)
    {
        var favicon = (source+"<!--[FAVICON] -->").split("<!--[FAVICON]")[1].split("-->")[0].trim();
        appendIcon(favicon ? makeAbsoluteUrl(baseUrl, favicon): makeAbsoluteUrl(location.href, "writinghex.128.png"));
    };
    var applyTheme = function(baseUrl, source)
    {
        var themes = (source+"<!--[THEME] -->").split("<!--[THEME]")
            .slice(1)
            .map
            (
                function(i)
                {
                    return i.split("-->")[0].trim();
                }
            )
            .filter(function(i) { return "" !== i });
        themes.forEach
        (
            function(i)
            {
                appendTheme(makeRebaseUrl(baseUrl, i));
            }
        );
        if (0 === themes.length)
        {
            appendTheme("theme/default.css");
        }
    };
    var applyStyle = function(source)
    {
        makeDomNode
        (
            {
                parent: document.head,
                tag: "style",
                innerHTML: (source+"<!--[STYLE] -->").split("<!--[STYLE]")[1].split("-->")[0].trim(),
            }
        );
    };
    var applyWallPaper = function(baseUrl, source)
    {
        document.body.className = "marked";

        var wallPaper = (source+"<!--[WALLPAPER] -->").split("<!--[WALLPAPER]")[1].split("-->")[0].trim();
        if (wallPaper)
        {
            document.body.className += " with-wallpaper";
            makeDomNode
            (
                {
                    parent: document.body,
                    tag: "div",
                    className: "wallpaper",
                    style:
                    {
                        backgroundImage: "url(\"" +makeRebaseUrl(baseUrl, wallPaper) +"\")",
                    },
                }
            );
        }

    };
    var applyIndex = function(source)
    {
        var withIndex = true;
        var index = null;
        if (withIndex)
        {
            index = makeIndexForMarked(source);
            if (index && 0 < index.length)
            {
                document.body.className += " with-index";
                makeDomNode
                (
                    {
                        parent: document.body,
                        tag: "div",
                        className: "index-frame",
                        children:
                        {
                            tag: "div",
                            className: "index",
                            onmouseenter: function() { globalState.isMouseOnIndex = true; },
                            onmouseleave: function() { globalState.isMouseOnIndex = false; },
                            children: index.map
                            (
                                function(i)
                                {
                                    return i.anchor = makeDomNode
                                    (
                                        {
                                            tag: "a",
                                            className: "level" + i.level,
                                            href: i.link,
                                            innerText: i.title,
                                        }
                                    );
                                }
                            )
                        }
                    }
                );
            }
            else
            {
                index = null;
            }
        }
        return index;
    };
    var applyIndexScript = function(index, contentDiv)
    {
        if (index)
        {
            var previousState = { i: 0 }; // 本来は -1 で初期化するべきだが、それだと後ろの setTimeout(contentDiv.onscroll, 0); による初期表示が意図通りに機能しないので 0 にしてる。 
            var isOver = function(i)
            {
                return index.length <= i ||
                        (0 <= i && 32 < document.getElementById(index[i].link.substring(1)).getBoundingClientRect().top);
            }
            var previousContent = null;
            for(var i in index)
            {
                var content = document.getElementById(index[i].link.substring(1));
                if (!content)
                {
                    console.log("not found: " +index[i].link);
                    index[i].withError = true;
                }
                else
                if (previousContent && content.getBoundingClientRect().top < previousContent.getBoundingClientRect().top)
                {
                    console.log("may be duplicated id: " +index[i].link);
                    index[i].withError = true;
                }
                if (!index[i].withError)
                {
                    previousContent = content;
                }
            }
            index = index.filter(function(i) { return !i.withError });

            if (0 < index.length)
            {
                contentDiv.onscroll = function()
                {
                    var previouseContetIsOver = isOver(previousState.i);
                    var nextContetIsOver = isOver(previousState.i +1);
                    if (previouseContetIsOver || !nextContetIsOver)
                    {
                        var i = null;
                        if (previouseContetIsOver)
                        {
                            //  上へ手繰る
                            while(isOver(--previousState.i)) { }
                        }
                        else
                        {
                            // 下へ手繰る
                            while(!isOver((++previousState.i) +1)) { }
                        }
                        var targetIndex = previousState.i < 0 ? null: index[previousState.i];
                        var current = document.getElementsByClassName("current")[0];
                        if (current !== (null === targetIndex ? null: targetIndex.anchor))
                        {
                            if (current)
                            {
                                current.classList.remove("current");
                            }
                            if (targetIndex)
                            {
                                targetIndex.anchor.classList.add("current");
                                window.history.replaceState(null, targetIndex.title, targetIndex.link);
                            }
                            else
                            {
                                index[0].anchor.classList.add("current");
                                window.history.replaceState(null, document.title, "#");
                            }
                            if (!globalState.isMouseOnIndex)
                            {
                                var frame = document.getElementsByClassName("index-frame")[0];
                                if (null === targetIndex)
                                {
                                    frame.scrollTop = 0;
                                }
                                else
                                {
                                    var rect = targetIndex.anchor.getBoundingClientRect();
                                    var targetTop = rect.top +frame.scrollTop;
                                    frame.scrollTop = targetTop - Math.min(frame.clientHeight -rect.height, ((targetTop / frame.scrollHeight) *frame.clientHeight));
                                }
                            }
                        }
                    }
                };
                setTimeout(contentDiv.onscroll, 0);
            }
        }
    };

    var render = function(renderer, baseUrl, source)
    {
        //  regulate return code
        source = source.replace(/\r\n/g,"\n");

        if ("true" === (source+"<!--[REFERRER-OPTION] false -->").split("<!--[REFERRER-OPTION]")[1].split("-->")[0].trim().toLowerCase())
        {
            console.log("referrer: " +document.referrer);
            var newUrl = location.href;
            var currentUrlParamNames = (location.href.split("#")[0] +"?")
                        .split("?")[1]
                        .split("&")
                        .filter(function(i) { return 0 < i.indexOf("=") })
                        .map(function(i) { return i.substr(0, i.indexOf("=")); });
                var referrerUrlParams = (document.referrer.split("#")[0] +"?")
                        .split("?")[1]
                        .split("&")
                        .filter(function(i) { return 0 < i.indexOf("=") })
                        .filter
                        (
                            function(i)
                            {
                                var name = i.substr(0, i.indexOf("="));
                                var result = true;
                                currentUrlParamNames.forEach(function(j) { if (j === name) { result = false; }});
                                return result;
                            }
                        );
            if (0 < referrerUrlParams.length)
            {
                newUrl = newUrl.replace("?", "?" +referrerUrlParams.join("&") +"&");
            }
            if (!renderer)
            {
                if ((document.referrer || "").split("?")[0] === location.href.split("?")[0])
                {
                    var newUrl = location.href;
                    var urlArgs = (document.referrer.split("#")[0] +"?")
                        .split("?")[1]
                        .split("&")
                        .filter(function(i) { return i.indexOf("=") < 0 })
                        .map(function(i) { return unescape(decodeURI(i));});
                    if (2 <= urlArgs.length)
                    {
                        renderer = urlArgs[0];
                        newUrl = newUrl.replace("?", "?" +renderer +"&");
                    }
                }
            }
            if (newUrl !== location.href)
            {
                window.history.replaceState(null, document.title, newUrl);
            }
        }
        if (!renderer)
        {
            renderer = /<!--\[RENDERER\]\s*(.*?)\s*-->/.exec(source +"<!--[RENDERER]MARKDOWN-->")[1].toLowerCase();
            console.log("renderer: " +(renderer || "null"));
        }
        var isWriting = true;
        var isMarked = "marked" === renderer;
        var isCommonMark = "commonmark" === renderer;
        var isMarkdown = isMarked || isCommonMark || "markdown" === renderer;
        var isRemark = "remark" === renderer;
        var isReveal = "reveal" === renderer;
        var isEdit = "edit" === renderer;
        if (!isMarkdown && !isRemark && !isReveal && !isEdit)
        {
            var message = "Unknown Rederer Name: \"" +renderer +"\" ( Rederer Names: \"markdown\"(default), \"remark\", \"reveal\", \"edit\" )";
            showError(message);
            console.error(message);
            return;
        }
        if (isMarkdown && !isMarked && !isCommonMark)
        {
            isMarked = true; // とりあえずいまは marked を default の markdown のレンダラーとして扱う
        }

        //  conditional comment
        if (!isEdit)
        {
            source = source
                .replace(/<!--\[WRITING\/\]([\s\S]*?)-->/g, isWriting ? "$1": "")
                .replace(/<!--\[WRITING\]-->([\s\S]*?)<!--\[\/WRITING\]-->/g, isWriting ? "$1": "")
                .replace(/<!--\[NOWRITING\/\]([\s\S]*?)-->/g, !isWriting ? "$1": "")
                .replace(/<!--\[NOWRITING\]-->([\s\S]*?)<!--\[\/NOWRITING\]-->/g, !isWriting ? "$1": "")
                .replace(/<!--\[MD\/\]([\s\S]*?)-->/g, isMarkdown ? "$1": "")
                .replace(/<!--\[MD\]-->([\s\S]*?)<!--\[\/MD\]-->/g, isMarkdown ? "$1": "")
                .replace(/<!--\[NOMD\/\]([\s\S]*?)-->/g, !isMarkdown ? "$1": "")
                .replace(/<!--\[NOMD\]-->([\s\S]*?)<!--\[\/NOMD\]-->/g, !isMarkdown ? "$1": "")
                .replace(/<!--\[MARKED\/\]([\s\S]*?)-->/g, isMarked ? "$1": "")
                .replace(/<!--\[MARKED\]-->([\s\S]*?)<!--\[\/MARKED\]-->/g, isMarked ? "$1": "")
                .replace(/<!--\[NOMARKED\/\]([\s\S]*?)-->/g, !isMarked ? "$1": "")
                .replace(/<!--\[NOMARKED\]-->([\s\S]*?)<!--\[\/NOMARKED\]-->/g, !isMarked ? "$1": "")
                .replace(/<!--\[COMMONMARK\/\]([\s\S]*?)-->/g, isCommonMark ? "$1": "")
                .replace(/<!--\[COMMONMARK\]-->([\s\S]*?)<!--\[\/COMMONMARK\]-->/g, isCommonMark ? "$1": "")
                .replace(/<!--\[NOCOMMONMARK\/\]([\s\S]*?)-->/g, !isCommonMark ? "$1": "")
                .replace(/<!--\[NOCOMMONMARK\]-->([\s\S]*?)<!--\[\/NOCOMMONMARK\]-->/g, !isCommonMark ? "$1": "")
                .replace(/<!--\[REMARK\/\]([\s\S]*?)-->/g, isRemark ? "$1": "")
                .replace(/<!--\[REMARK\]-->([\s\S]*?)<!--\[\/REMARK\]-->/g, isRemark ? "$1": "")
                .replace(/<!--\[NOREMARK\/\]([\s\S]*?)-->/g, !isRemark ? "$1": "")
                .replace(/<!--\[NOREMARK\]-->([\s\S]*?)<!--\[\/NOREMARK\]-->/g, !isRemark ? "$1": "")
                .replace(/<!--\[REVEAL\/\]([\s\S]*?)-->/g, isReveal ? "$1": "")
                .replace(/<!--\[REVEAL\]-->([\s\S]*?)<!--\[\/REVEAL\]-->/g, isReveal ? "$1": "")
                .replace(/<!--\[NOREVEAL\/\]([\s\S]*?)-->/g, !isReveal ? "$1": "")
                .replace(/<!--\[NOREVEAL\]-->([\s\S]*?)<!--\[\/NOREVEAL\]-->/g, !isReveal ? "$1": "");
        }

        //  title
        applyTitle(source);

        //  favicon
        applyIcon(baseUrl, source);

        if (isMarked)
        {
            //  marked
            appendTheme("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css");

            //  theme
            applyTheme(baseUrl, source);

            //  style
            applyStyle(source);

            loadScript
            (
                "js/marked.js",
                function()
                {
                    var config = { gfm: true, tables: true };
                    try
                    {
                        config = JSON.parse((source+"<!--[MARKED-CONFIG] { \"gfm\": true, \"tables\": true } -->").split("<!--[MARKED-CONFIG]")[1].split("-->")[0].trim());
                    }
                    catch(e)
                    {
                        console.error(new Error().stack);
                        console.error(JSON.stringify(e));
                    }
                    console.log("marked-config: " +JSON.stringify(config, null, 4));
                    var linkMaker = new markdownHeaderFragmentMaker();
                    var markedRenderer = new marked.Renderer();
                    markedRenderer.heading = function (text, level, raw)
                    {
                        return '<h'
                        + level
                        + ' id="'
                        + this.options.headerPrefix
                        + linkMaker.makeFragment(raw)
                        //+ raw.toLowerCase().replace(/[\!\"\#\$\%\&\'\(\)\*\+\,\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~]/g,"").replace(/ /g,"-")
                        + '">'
                        + text.replace(explicitFragmentIdPattern, "")
                        + '</h'
                        + level
                        + '>\n';
                    };
                    config.renderer = markedRenderer;
                    marked.setOptions(config);

                    //  wallpaper
                    applyWallPaper(baseUrl, source);
                    
                    //  index
                    var index = applyIndex(source);

                    var contentDiv = makeDomNode
                    (
                        {
                            parent: document.body,
                            tag: "div",
                            className: "content",
                            innerHTML: marked
                            (
                                skipEscape
                                (
                                    translateRelativeLink(baseUrl, source).split("\n"),
                                    function(line)
                                    {
                                        return line
                                            .replace(/\\</g, "&lt;")
                                            .replace(/\\>/g, "&gt;")
                                            .replace(/\\\\/g, "\\");
                                    }
                                ).join("\n")
                                .replace(/\n\$\$\n([\W\w]*?)\n\$\$\n/g, "\n<pre class=\"mathjax\">\n$$$$\n$1\n$$$$\n</pre>\n")
                            ),
                            children: index ?
                                makeDomNode({ tag: "div", style: { height: "90vh", }, }):
                                undefined,
                        }
                    );

                    var fragmentId = decodeURI((location.href +"#").split("#")[1].trim());
                    if (fragmentId)
                    {
                        location.href = "#" +fragmentId;
                    }

                    //  index script
                    applyIndexScript(index, contentDiv);

                    //  highlight
                    loadScript
                    (
                        "//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js",
                        function()
                        {
                            hljs.initHighlightingOnLoad();
                            document.querySelectorAll("code").forEach
                            (
                                function(element)
                                {
                                    //  highlightjs が知らない言語が指定されてるとなにも実行されなくなるので指定を消すなり類似した言語に変換する
                                    switch(element.className)
                                    {
                                        case "lang-cmd":
                                            element.className = "lang-shell";
                                            break;
                                    }

                                    return hljs.highlightBlock(element);
                                }
                            );

                            //  MathJax
                            loadScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML");

                            //  twitter
                            loadScript("//platform.twitter.com/widgets.js");
                        }
                    );
                }
            );
        }
        if (isCommonMark)
        {
            //  commonmark
            appendTheme("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css");

            //  theme
            applyTheme(baseUrl, source);

            //  style
            applyStyle(source);

            loadScript
            (
                "js/commonmark.js",
                function()
                {
                    //  wallpaper
                    applyWallPaper(baseUrl, source);
                    
                    //  index
                    var index = applyIndex(source);

                    var contentDiv = makeDomNode
                    (
                        {
                            parent: document.body,
                            tag: "div",
                            className: "content",
                            innerHTML: new commonmark.HtmlRenderer().render
                            (
                                new commonmark.Parser().parse
                                (
                                    skipEscape
                                    (
                                        translateRelativeLink(baseUrl, source).split("\n"),
                                        function(line)
                                        {
                                            return line
                                                .replace(/\\</g, "&lt;")
                                                .replace(/\\>/g, "&gt;")
                                                .replace(/\\\\/g, "\\");
                                        }
                                    ).join("\n")
                                    .replace(/\n\$\$\n([\W\w]*?)\n\$\$\n/g, "\n<pre class=\"mathjax\">\n$$$$\n$1\n$$$$\n</pre>\n")
                                )
                            ),
                            children: index ?
                                makeDomNode({ tag: "div", style: { height: "90vh", }, }):
                                undefined,
                        }
                    );

                    var fragmentId = decodeURI((location.href +"#").split("#")[1].trim());
                    if (fragmentId)
                    {
                        location.href = "#" +fragmentId;
                    }

                    //  index script
                    applyIndexScript(index, contentDiv);

                    //  highlight
                    loadScript
                    (
                        "//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js",
                        function()
                        {
                            hljs.initHighlightingOnLoad();
                            document.querySelectorAll("code").forEach
                            (
                                function(element)
                                {
                                    //  highlightjs が知らない言語が指定されてるとなにも実行されなくなるので指定を消すなり類似した言語に変換する
                                    switch(element.className)
                                    {
                                        case "lang-cmd":
                                            element.className = "lang-shell";
                                            break;
                                    }

                                    return hljs.highlightBlock(element);
                                }
                            );

                            //  MathJax
                            loadScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML");

                            //  twitter
                            loadScript("//platform.twitter.com/widgets.js");
                        }
                    );
                }
            );
        }
        if (isRemark)
        {
            //  theme
            applyTheme(baseUrl, source);

            //  style
            applyStyle(source);
            
            source = skipEscape
            (
                source.split("\n"),
                function(line)
                {
                    if (">>>" === line)
                    {
                        line = "---";
                    }
                    return line;
                }
            ).join("\n");
            
            //  remark
            loadScript
            (
                "js/remark-latest.min.js",
                function()
                {
                    var config = JSON.parse((source+"<!--[REMARK-CONFIG] { } -->").split("<!--[REMARK-CONFIG]")[1].split("-->")[0].trim());
                    config.source = translateRelativeLink(baseUrl, translateLinkWithinPageForRemark(translateForSlide(source)))
                        .replace(/([^\n])```([^\n])/g, "$1`$2")
                        .replace(/\n\$\$\n([\W\w]*?)\n\$\$\n/g, "\n<pre class=\"mathjax\">\n$$$$\n$1\n$$$$\n</pre>\n");
                    var slideshow = remark.create(config);

                    //  MathJax
                    loadScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML");

                    //  twitter
                    loadScript("//platform.twitter.com/widgets.js");
                }
            );
        }
        if (isReveal)
        {
            //  reveal
            appendTheme("css/reveal.css");
            var revealTheme = /<!--\[REVEAL-THEME\]\s*(.*?)\s*-->/.exec(source +"<!--[REVEAL-THEME]league-->")[1].toLowerCase();
            console.log("reveal-theme: " +revealTheme);
            appendTheme("css/theme/" +revealTheme +".css", "theme");
            var documentTheme = document.getElementById("theme");
            appendTheme("lib/css/zenburn.css");
            appendTheme(window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css');
            
            //  theme
            applyTheme(baseUrl, source);

            //  style
            applyStyle(source);

            makeDomNode
            (
                {
                    parent: document.head,
                    tag: "style",
                    innerHTML: (source+"<!--[STYLE] -->").split("<!--[STYLE]")[1].split("-->")[0].trim(),
                }
            );

            //  paste markdown
            var separator = (source+"<!--[REVEAL-SEPARATOR] ^\\n---$ -->").split("<!--[REVEAL-SEPARATOR]")[1].split("-->")[0].trim();
            var separator_vertical = (source+"<!--[REVEAL-SEPARATOR-VERTICAL] ^\\n>>>$ -->").split("<!--[REVEAL-SEPARATOR-VERTICAL]")[1].split("-->")[0].trim();
            var separator_notes = (source+"<!--[REVEAL-SEPARATOR-NOTES] ^Note: -->").split("<!--[REVEAL-SEPARATOR-NOTES]")[1].split("-->")[0].trim();
            var pasteMarkdown = function(markdown)
            {
                return makeDomNode
                (
                    {
                        parent: document.body,
                        tag: "div",
                        className: "reveal",
                        children:
                        {
                            tag: "div",
                            className: "slides",
                            children:
                            {
                                tag: "section",
                                attributes:
                                {
                                    "data-markdown": "",
                                    "data-separator": separator,
                                    "data-separator-vertical": separator_vertical,
                                    "data-separator-notes": separator_notes,
                                },
                                children:
                                {
                                    tag: "script",
                                    type: "text/template",
                                    innerHTML: markdown.replace(/\n\$\$\n([\W\w]*?)\n\$\$\n/g, "\n<pre class=\"mathjax\">\n$$$$\n$1\n$$$$\n</pre>\n"),
                                },
                            },
                        },
                    }
                );
            };
            pasteMarkdown(translateRelativeLink(baseUrl, translateLinkWithinPageForReveal(translateForSlide(source))));
            loadScript
            (
                "lib/js/head.min.js",
                function()
                {
                    loadScript
                    (
                        "js/reveal.js",
                        function()
                        {
                            var revealTransition = /<!--\[REVEAL-TRANSITION\]\s*(.*?)\s*-->/.exec(source +"<!--[REVEAL-TRANSITION]concave-->")[1].toLowerCase();
                            console.log("reveal-transition: " +revealTransition);
                            console.log("reveal-theme(forced by url param): " +Reveal.getQueryHash().theme);
                            console.log("reveal-transition(forced by url param): " +Reveal.getQueryHash().transition);
                            var forceTheme = Reveal.getQueryHash().theme;
                            if (forceTheme)
                            {
                                documentTheme.href = "css/theme/" +forceTheme +".css";
                            }
                            // More info about config & dependencies:
                            // - https://github.com/hakimel/reveal.js#configuration
                            // - https://github.com/hakimel/reveal.js#dependencies
                            var config = JSON.parse((source+"<!--[REVEAL-CONFIG] { } -->").split("<!--[REVEAL-CONFIG]")[1].split("-->")[0].trim());
                            console.log("reveal-config: " +JSON.stringify(config, null, 4));
                            var defaultConfig =
                            {
                                controls: true,
                                progress: true,
                                history: true,
                                center: true,
                                transition: Reveal.getQueryHash().transition || revealTransition, 
                                math:
                                {
                                    mathjax: '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js',
                                    config: 'TeX-AMS_HTML-full'
                                },
                                dependencies:
                                [
                                    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                                    { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                                    { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                                    { src: 'plugin/highlight/highlight.js', async: true, callback: function() {
                                        hljs.initHighlightingOnLoad();
                                        document.querySelectorAll('code').forEach(hljs.highlightBlock);
                                    } },
                                    { src: 'plugin/search/search.js', async: true },
                                    { src: 'plugin/zoom-js/zoom.js', async: true },
                                    { src: 'plugin/notes/notes.js', async: true },
                                    { src: 'plugin/math/math.js', async: true },
                                    { src: "//platform.twitter.com/widgets.js", async: true }
                                ]
                            };
                            Reveal.initialize(objectAssign(defaultConfig, config));
                        }
                    );
                }
            );
        }
        if (isEdit)
        {
            //  edit
            recursiveAssign
            (
                document.body.style,
                {
                    margin: "0",
                    overflow: "hidden",
                    backgroundColor: "#86812A",
                }
            );
            var urlsDiv = makeDomNode
            (
                {
                    parent: document.body,
                    tag:"div",
                    style:
                    {
                        padding: "0.5rem 1.0rem",
                        width: "100%",
                        height: "1rem",
                        verticalAlign: "middle",
                        lineHeight: "1rem",
                    },
                }
            );
            var textCounter = makeDomNode
            (
                {
                    parent: urlsDiv,
                    tag: "span",
                    style:
                    {
                        color: "#CCCCCC",
                        padding: "0rem 1.0rem",
                    }
                }
            );
            var makeLink = function(text)
            {
                return makeDomNode
                (
                    {
                        parent: urlsDiv,
                        tag: "a",
                        style:
                        {
                            color: "#FFFFFF",
                            padding: "0rem 1.0rem",
                        },
                        text: text,
                        target: "_blank",
                    }
                );
            }
            var defaultLink = makeLink("default");
            var markedLink = makeLink("marked(markdown)");
            var remarkLink = makeLink("remark(slide)");
            var revealLink = makeLink("reveal(slide)");
            var editLink = makeLink("edit");
            var update = function() {
                var text = encodeURIComponent(textarea.value);
                textCounter.innerText = "lenght:" +text.length;
                defaultLink.href = "?text:" +text;
                markedLink.href = "?markdown&text:" +text;
                remarkLink.href = "?remark&text:" +text;
                revealLink.href = "?reveal&text:" +text;
                editLink.href = "?edit&text:" +text;
            };
            var textarea = makeDomNode
            (
                {
                    parent: document.body,
                    tag: "textarea",
                    style:
                    {
                        width: "100%",
                        height: "100%",
                        margin: "0rem 1rem 1rem 1rem",
                    },
                    value: source,
                    eventListener:
                    {
                        change: update,
                        keyup: update,
                    },
                }
            );
            recursiveAssign
            (
                textarea.style,
                {
                    width: "calc(100vw - 2rem)",
                    height: "calc(100vh - 3rem)",
                }
            );
            update();
        }
    };
    var renderer = null; 
    var sourceUrl = null;
    var urlArgs = (location.href.split("#")[0] +"?")
        .split("?")[1]
        .split("&")
        .filter(function(i) { return i.indexOf("=") < 0 })
        .map(function(i) { return unescape(decodeURI(i));});
    if (1 <= urlArgs.length)
    {
        if (2 <= urlArgs.length)
        {
            renderer = urlArgs[0];
            sourceUrl = urlArgs[1];
        }
        else
        {
            sourceUrl = urlArgs[0];
        }
        sourceUrl = sourceUrl
            .replace(/^(?:https\:)?\/\/github\.com\/([^/]+\/[^/]+)\/blob\/(.*\.md)(#.*)?$/, "https://raw.githubusercontent.com/$1/$2");
    }
    if (!sourceUrl)
    {
        sourceUrl = "index.md";
    }
    console.log("renderer(forced by url param): " +(renderer || "null"));
    console.log("loading: " +sourceUrl);
    if ("text:" === sourceUrl.slice(0, 5))
    {
        render(renderer, location.href, sourceUrl.slice(5));
    }
    else
    {
        var request = new XMLHttpRequest();
        request.open('GET', sourceUrl, true);
        request.onreadystatechange = function()
        {
            if (4 === request.readyState)
            {
                if (200 <= request.status && request.status < 300)
                {
                    render(renderer, makeAbsoluteUrl(location.href, sourceUrl), request.responseText);
                }
                else
                {
                    showError
                    (
                        [
                            "loading failed: { \"method\": \"GET\", \"url\": \"",
                            {
                                tag: "a",
                                href: sourceUrl,
                                style:
                                {
                                    color: "#6666FF",
                                },
                                children: sourceUrl,
                            },
                            "\", \"status\": "+ request.status + "};"
                        ]
                    );
                    var responseDiv =
                    {
                        parent: document.body,
                        tag: "div",
                    };
                    if (request.responseText)
                    {
                        responseDiv.innerHTML = request.responseText;
                    }
                    else
                    {
                        responseDiv.style =
                        {
                            whiteSpace: "pre-wrap",
                            fontSize: "1.5rem",
                            padding: "20px",
                        };
                        if (0 === request.status)
                        {
                            responseDiv.innerText = "There ia a possibility that server not found or it happened cross-domain issue.\nサーバーが見つからないかクロスドメインの問題が発生した可能性があります。";
                        }
                        else
                        {
                            responseDiv.innerText = JSON.stringify(request.getAllResponseHeaders(), null, 4);
                        }
                    }
                    makeDomNode(responseDiv);
                }
            }
        };
        request.send(null);
    }
})();
</script></body>